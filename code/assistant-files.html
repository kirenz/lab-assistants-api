<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lab - Assistants API and Files</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//images/logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slide.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../require.html"> 
<span class="menu-text">Requirements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#initialize-openai-client" id="toc-initialize-openai-client" class="nav-link" data-scroll-target="#initialize-openai-client">Initialize OpenAI client</a></li>
  <li><a href="#create-assistant" id="toc-create-assistant" class="nav-link" data-scroll-target="#create-assistant">Create Assistant</a></li>
  <li><a href="#create-thread" id="toc-create-thread" class="nav-link" data-scroll-target="#create-thread">Create Thread</a>
  <ul class="collapse">
  <li><a href="#how-to-obbtain-the-thread-id" id="toc-how-to-obbtain-the-thread-id" class="nav-link" data-scroll-target="#how-to-obbtain-the-thread-id">How to Obbtain the Thread id</a></li>
  </ul></li>
  <li><a href="#add-a-message-file" id="toc-add-a-message-file" class="nav-link" data-scroll-target="#add-a-message-file">Add a Message &amp; File</a>
  <ul class="collapse">
  <li><a href="#create-file" id="toc-create-file" class="nav-link" data-scroll-target="#create-file">Create file</a></li>
  <li><a href="#create-message" id="toc-create-message" class="nav-link" data-scroll-target="#create-message">Create message</a></li>
  </ul></li>
  <li><a href="#create-run" id="toc-create-run" class="nav-link" data-scroll-target="#create-run">Create Run</a>
  <ul class="collapse">
  <li><a href="#run-objects" id="toc-run-objects" class="nav-link" data-scroll-target="#run-objects">Run objects</a></li>
  <li><a href="#run-objects-explained" id="toc-run-objects-explained" class="nav-link" data-scroll-target="#run-objects-explained">Run objects explained</a></li>
  <li><a href="#inspect-status-of-the-run" id="toc-inspect-status-of-the-run" class="nav-link" data-scroll-target="#inspect-status-of-the-run">Inspect status of the Run</a></li>
  <li><a href="#retrieve-current-run" id="toc-retrieve-current-run" class="nav-link" data-scroll-target="#retrieve-current-run">Retrieve current Run</a></li>
  </ul></li>
  <li><a href="#retrieve-messages" id="toc-retrieve-messages" class="nav-link" data-scroll-target="#retrieve-messages">Retrieve Messages</a>
  <ul class="collapse">
  <li><a href="#inspect-all-messages" id="toc-inspect-all-messages" class="nav-link" data-scroll-target="#inspect-all-messages">Inspect all messages</a></li>
  </ul></li>
  <li><a href="#obtain-text-response" id="toc-obtain-text-response" class="nav-link" data-scroll-target="#obtain-text-response">Obtain text response</a>
  <ul class="collapse">
  <li><a href="#display-response-of-assistant" id="toc-display-response-of-assistant" class="nav-link" data-scroll-target="#display-response-of-assistant">Display response of assistant</a></li>
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output">Output</a></li>
  <li><a href="#extract-only-text-response" id="toc-extract-only-text-response" class="nav-link" data-scroll-target="#extract-only-text-response">Extract only text response</a></li>
  </ul></li>
  <li><a href="#download-images-and-files" id="toc-download-images-and-files" class="nav-link" data-scroll-target="#download-images-and-files">Download images and files</a>
  <ul class="collapse">
  <li><a href="#get-file-content" id="toc-get-file-content" class="nav-link" data-scroll-target="#get-file-content">Get file content</a></li>
  <li><a href="#work-in-progress" id="toc-work-in-progress" class="nav-link" data-scroll-target="#work-in-progress">Work in progress 😊</a></li>
  </ul></li>
  <li><a href="#input-and-output-logs-of-code-interpreter" id="toc-input-and-output-logs-of-code-interpreter" class="nav-link" data-scroll-target="#input-and-output-logs-of-code-interpreter">Input and output logs of Code Interpreter</a>
  <ul class="collapse">
  <li><a href="#run-steps" id="toc-run-steps" class="nav-link" data-scroll-target="#run-steps">Run steps</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assistants API and Files</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We create an Assistant that can create data visualization based on a .csv file to demonstrate how to upload and download files using OpenAi’s Assistants API.</p>
<section id="setup" class="level1">
<h1>Setup</h1>
<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv, find_dotenv</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> load_dotenv(find_dotenv())</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>openai.api_key <span class="op">=</span> os.getenv(<span class="st">'OPENAI_API_KEY'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="initialize-openai-client" class="level1">
<h1>Initialize OpenAI client</h1>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-assistant" class="level1">
<h1>Create Assistant</h1>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>assistant <span class="op">=</span> client.beta.assistants.create(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"Data Visualizations"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    instructions<span class="op">=</span><span class="st">"You are great at creating beautiful data visualizations. You analyze data present in .csv files, understand relationships between variables, and create data visualizations relevant to those relationships. You also share a brief text summary of the relationships observed."</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    tools<span class="op">=</span>[ {<span class="st">"type"</span>: <span class="st">"code_interpreter"</span>}],</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4-1106-preview"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-thread" class="level1">
<h1>Create Thread</h1>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>thread <span class="op">=</span> client.beta.threads.create()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--

::: {#cell-10 .cell}
``` {.python .cell-code}
thread = client.beta.threads.create(
  messages=[
    {
      "role": "user",
      "content": "Create a data visualization based on the relationship of the variables Miles_per_Gallon and Horsepower in this file. Interpret the findings",
      "file_ids": [file.id]
    }
  ]
)
```
:::


-->
<section id="how-to-obbtain-the-thread-id" class="level2">
<h2 class="anchored" data-anchor-id="how-to-obbtain-the-thread-id">How to Obbtain the Thread id</h2>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>thread</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Thread(id=‘thread_iB6WpSbp6r6j9ayrdHIyyafC’, created_at=1699520936, metadata={}, object=‘thread’)</li>
</ul>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>thread_id <span class="op">=</span> thread.<span class="bu">id</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Thread ID: </span><span class="sc">{</span>thread_id<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Thread ID: thread_iB6WpSbp6r6j9ayrdHIyyafC</li>
</ul>
<!--

# Step 3: Add a Message to a Thread

## Create message

- A Message contains the user's text, and optionally, any files that the user uploads (no images). 

::: {#cell-16 .cell}
``` {.python .cell-code}
message = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content="Create a data visualization based on the relationship of the variables Miles_per_Gallon and Horsepower in this file. Interpret the findings of the plot you have created",
    file_ids=[file.id]
)
```
:::


## Obtain message id

::: {#cell-18 .cell}
``` {.python .cell-code}
message_id = message.id  
print(f'Message ID: {message_id}')
```
:::


# Annotations

- Annotations provide information around how you should annotate the text in the Message:

  - `file_citation`: File citations are created by the retrieval tool and define references to a specific quote in a specific file that was uploaded and used by the Assistant to generate the response.

  - `file_path`: File path annotations are created by the code_interpreter tool and contain references to the files generated by the tool.


## Annotations code example {.smaller}

::: {#cell-20 .cell}
``` {.python .cell-code}
# Retrieve the message object
message = client.beta.threads.messages.retrieve(
  thread_id=thread_id,
  message_id=message_id
)

# Assuming the 'message' object has a 'content' attribute which is a list,
# and that the first item in the list is a MessageContentText object (as in your example)

# Extract the message content
# Make sure that the 'message.content' actually contains items before accessing
if message.content:
    message_content = message.content[0].text
    annotations = message_content.annotations
    citations = []

    # Iterate over the annotations and add footnotes
    for index, annotation in enumerate(annotations):
        # Replace the text with a footnote
        message_content.value = message_content.value.replace(annotation.text, f' [{index}]')

        # Gather citations based on annotation attributes
        # Here you must ensure that the annotation object has these attributes
        if hasattr(annotation, 'file_citation') and annotation.file_citation:
            file_citation = annotation.file_citation
            cited_file = client.files.retrieve(file_citation.file_id)
            citations.append(f'[{index}] {file_citation.quote} from {cited_file.filename}')
        elif hasattr(annotation, 'file_path') and annotation.file_path:
            file_path = annotation.file_path
            cited_file = client.files.retrieve(file_path.file_id)
            citations.append(f'[{index}] Click <here> to download {cited_file.filename}')
            # You would need to implement the file download functionality here

    # Add footnotes to the end of the message before displaying to the user
    message_content.value += '\n' + '\n'.join(citations)
    print(message_content.value)
```
:::


- Create a data visualizations based on the relationship of the variables Miles_per_Gallon and Horsepower in this file.

-->
</section>
</section>
<section id="add-a-message-file" class="level1">
<h1>Add a Message &amp; File</h1>
<ul>
<li>You can attach a maximum of 20 files per Assistant</li>
<li>They can be at most 512 MB each.</li>
<li>The size of all the files uploaded by an organization should not exceed 100GB.</li>
</ul>
<section id="create-file" class="level2">
<h2 class="anchored" data-anchor-id="create-file">Create file</h2>
<ul>
<li>Usually, we could simply input the file in a UI</li>
<li>Here, we have to upload it</li>
</ul>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>file_response <span class="op">=</span> client.files.create(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">file</span><span class="op">=</span><span class="bu">open</span>(<span class="st">"cars.csv"</span>, <span class="st">"rb"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  purpose<span class="op">=</span><span class="st">'assistants'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>file_id <span class="op">=</span> file_response.<span class="bu">id</span>  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(file_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>file-4la1LvfQKJMgGxsKobJQBWkH</li>
</ul>
</section>
<section id="create-message" class="level2">
<h2 class="anchored" data-anchor-id="create-message">Create message</h2>
<ul>
<li>A Message contains the user’s text, and optionally, any files that the user uploads (no images).</li>
</ul>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>message <span class="op">=</span> client.beta.threads.messages.create(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    thread_id<span class="op">=</span>thread.<span class="bu">id</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    role<span class="op">=</span><span class="st">'user'</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    content<span class="op">=</span><span class="st">"Create a data visualization based on the relationship of the variables Miles_per_Gallon and Horsepower in this file. Interpret the findings of the plot you have created"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    file_ids<span class="op">=</span>[file_id]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-run" class="level1">
<h1>Create Run</h1>
<ul>
<li>When you have all the context you need from your user in the Thread, you can run the Thread with an Assistant of your choice.</li>
</ul>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> client.beta.threads.runs.create(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  thread_id<span class="op">=</span>thread.<span class="bu">id</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  assistant_id<span class="op">=</span>assistant.<span class="bu">id</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="run-objects" class="level2">
<h2 class="anchored" data-anchor-id="run-objects">Run objects</h2>
<p><img src="../images/run.png" class="img-fluid"></p>
</section>
<section id="run-objects-explained" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="run-objects-explained">Run objects explained</h2>
<table class="table">
<thead>
<tr class="header">
<th>STATUS</th>
<th>DEFINITION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>queued</code></td>
<td>When Runs are first created or when you complete the&nbsp;<code>required_action</code>, they are moved to a queued status. They should almost immediately move to&nbsp;<code>in_progress</code>.</td>
</tr>
<tr class="even">
<td><code>in_progress</code></td>
<td>While in_progress, the Assistant uses the model and tools to perform steps. You can view progress being made by the Run by examining the&nbsp;<a href="https://platform.openai.com/docs/api-reference/runs/step-object">Run Steps</a>.</td>
</tr>
<tr class="odd">
<td><code>completed</code></td>
<td>The Run successfully completed! You can now view all Messages the Assistant added to the Thread, and all the steps the Run took. You can also continue the conversation by adding more user Messages to the Thread and creating another Run.</td>
</tr>
<tr class="even">
<td><code>requires_action</code></td>
<td>When using the&nbsp;<a href="https://platform.openai.com/docs/assistants/tools/function-calling">Function calling</a>&nbsp;tool, the Run will move to a&nbsp;<code>required_action</code>&nbsp;state once the model determines the names and arguments of the functions to be called. You must then run those functions and&nbsp;<a href="https://platform.openai.com/docs/api-reference/runs/submitToolOutputs">submit the outputs</a>&nbsp;before the run proceeds. If the outputs are not provided before the&nbsp;<code>expires_at</code>&nbsp;timestamp passes (roughly 10 mins past creation), the run will move to an expired status.</td>
</tr>
<tr class="odd">
<td><code>expired</code></td>
<td>This happens when the function calling outputs were not submitted before&nbsp;<code>expires_at</code>&nbsp;and the run expires. Additionally, if the runs take too long to execute and go beyond the time stated in&nbsp;<code>expires_at</code>, our systems will expire the run.</td>
</tr>
<tr class="even">
<td><code>cancelling</code></td>
<td>You can attempt to cancel an&nbsp;<code>in_progress</code>&nbsp;run using the&nbsp;<a href="https://platform.openai.com/docs/api-reference/runs/cancelRun">Cancel Run</a>&nbsp;endpoint. Once the attempt to cancel succeeds, status of the Run moves to&nbsp;<code>cancelled</code>. Cancellation is attempted but not guaranteed.</td>
</tr>
<tr class="odd">
<td><code>cancelled</code></td>
<td>Run was successfully cancelled.</td>
</tr>
<tr class="even">
<td><code>failed</code></td>
<td>You can view the reason for the failure by looking at the&nbsp;<code>last_error</code>&nbsp;object in the Run. The timestamp for the failure will be recorded under&nbsp;<code>failed_at</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li></li>
</ul>
</section>
<section id="inspect-status-of-the-run" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="inspect-status-of-the-run">Inspect status of the Run</h2>
<ul>
<li><p>You need to wait until the status=‘completed’ before you can retrieve the Messages added by the Assistant.</p></li>
<li><p>Let’s check the status</p></li>
</ul>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>run.status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>‘queued’</li>
</ul>
</section>
<section id="retrieve-current-run" class="level2">
<h2 class="anchored" data-anchor-id="retrieve-current-run">Retrieve current Run</h2>
<ul>
<li>Again, check the current status with <code>retrieve</code></li>
</ul>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> client.beta.threads.runs.retrieve(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  thread_id<span class="op">=</span>thread.<span class="bu">id</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  run_id<span class="op">=</span>run.<span class="bu">id</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(run.status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>‘completed’</li>
</ul>
</section>
</section>
<section id="retrieve-messages" class="level1 smaller">
<h1 class="smaller">Retrieve Messages</h1>
<p>Once the Run completes, you can retrieve the Messages added by the Assistant to the Thread.</p>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>messages_cursor <span class="op">=</span> client.beta.threads.messages.<span class="bu">list</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  thread_id<span class="op">=</span>thread.<span class="bu">id</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="inspect-all-messages" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="inspect-all-messages">Inspect all messages</h2>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(messages_cursor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>SyncCursorPage[ThreadMessage](data<span class="op">=</span>[ThreadMessage(<span class="bu">id</span><span class="op">=</span><span class="st">'msg_mMdjZ6raDxzbYr065ojq9jav'</span>, assistant_id<span class="op">=</span><span class="st">'asst_oLnJ4yhowVZrqUecc8OCtNaL'</span>, content<span class="op">=</span>[MessageContentImageFile(image_file<span class="op">=</span>ImageFile(file_id<span class="op">=</span><span class="st">'file-98KwkltWZr4n0kZxMUdqIzTM'</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'image_file'</span>), MessageContentText(text<span class="op">=</span>Text(annotations<span class="op">=</span>[], value<span class="op">=</span><span class="st">"The scatter plot above displays the relationship between 'Horsepower' and 'Miles per Gallon' (MPG). From the plot, we can observe the following:</span><span class="ch">\n\n</span><span class="st">- There is a general negative correlation between Horsepower and Miles per Gallon. This means that as Horsepower increases, MPG tends to decrease.</span><span class="ch">\n</span><span class="st">- This relationship can be attributed to the fact that cars with higher horsepower values are usually more powerful and may require more fuel to sustain that power, resulting in lower fuel efficiency.</span><span class="ch">\n\n</span><span class="st">However, it is important to note that other factors not depicted in this plot could also influence the MPG, such as the weight of the car, the type of engine, and aerodynamic design. For more comprehensive insights, it would be beneficial to consider these variables in future analyses.</span><span class="ch">\n\n</span><span class="st">Would you like to perform any further analysis on this dataset or have any other questions?"</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>)], created_at<span class="op">=</span><span class="dv">1699521035</span>, file_ids<span class="op">=</span>[], metadata<span class="op">=</span>{}, <span class="bu">object</span><span class="op">=</span><span class="st">'thread.message'</span>, role<span class="op">=</span><span class="st">'assistant'</span>, run_id<span class="op">=</span><span class="st">'run_kctoJoy5qZcNukQK5dKadfMD'</span>, thread_id<span class="op">=</span><span class="st">'thread_iB6WpSbp6r6j9ayrdHIyyafC'</span>), ThreadMessage(<span class="bu">id</span><span class="op">=</span><span class="st">'msg_vaS3zpOTi6sDzeXwZWyQjEvT'</span>, assistant_id<span class="op">=</span><span class="st">'asst_oLnJ4yhowVZrqUecc8OCtNaL'</span>, content<span class="op">=</span>[MessageContentText(text<span class="op">=</span>Text(annotations<span class="op">=</span>[], value<span class="op">=</span><span class="st">"The data has been successfully loaded and it contains the following columns: 'Name', 'Miles_per_Gallon', 'Cylinders', 'Displacement', 'Horsepower', 'Weight_in_lbs', 'Acceleration', 'Year', and 'Origin'.</span><span class="ch">\n\n</span><span class="st">Next, I will create a scatter plot to visualize the relationship between 'Miles_per_Gallon' (MPG) and 'Horsepower'. The scatter plot will help us understand if there's a trend or correlation between these two variables. Let's create the plot now."</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>)], created_at<span class="op">=</span><span class="dv">1699521019</span>, file_ids<span class="op">=</span>[], metadata<span class="op">=</span>{}, <span class="bu">object</span><span class="op">=</span><span class="st">'thread.message'</span>, role<span class="op">=</span><span class="st">'assistant'</span>, run_id<span class="op">=</span><span class="st">'run_kctoJoy5qZcNukQK5dKadfMD'</span>, thread_id<span class="op">=</span><span class="st">'thread_iB6WpSbp6r6j9ayrdHIyyafC'</span>), ThreadMessage(<span class="bu">id</span><span class="op">=</span><span class="st">'msg_jFgAaY1O0aTLw1bI7eyUuqy0'</span>, assistant_id<span class="op">=</span><span class="st">'asst_oLnJ4yhowVZrqUecc8OCtNaL'</span>, content<span class="op">=</span>[MessageContentText(text<span class="op">=</span>Text(annotations<span class="op">=</span>[], value<span class="op">=</span><span class="st">"First, let's load the .csv file and preview its contents to understand the structure of the data. Then we can analyze the variables Miles_per_Gallon and Horsepower and create a data visualization to interpret their relationship. I will start by loading the data."</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>)], created_at<span class="op">=</span><span class="dv">1699521009</span>, file_ids<span class="op">=</span>[], metadata<span class="op">=</span>{}, <span class="bu">object</span><span class="op">=</span><span class="st">'thread.message'</span>, role<span class="op">=</span><span class="st">'assistant'</span>, run_id<span class="op">=</span><span class="st">'run_kctoJoy5qZcNukQK5dKadfMD'</span>, thread_id<span class="op">=</span><span class="st">'thread_iB6WpSbp6r6j9ayrdHIyyafC'</span>), ThreadMessage(<span class="bu">id</span><span class="op">=</span><span class="st">'msg_0WMtoLxPzCXB14wNTIicUkqO'</span>, assistant_id<span class="op">=</span><span class="va">None</span>, content<span class="op">=</span>[MessageContentText(text<span class="op">=</span>Text(annotations<span class="op">=</span>[], value<span class="op">=</span><span class="st">'Create a data visualization based on the relationship of the variables Miles_per_Gallon and Horsepower in this file. Interpret the findings of the plot you have created'</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>)], created_at<span class="op">=</span><span class="dv">1699521002</span>, file_ids<span class="op">=</span>[<span class="st">'file-4la1LvfQKJMgGxsKobJQBWkH'</span>], metadata<span class="op">=</span>{}, <span class="bu">object</span><span class="op">=</span><span class="st">'thread.message'</span>, role<span class="op">=</span><span class="st">'user'</span>, run_id<span class="op">=</span><span class="va">None</span>, thread_id<span class="op">=</span><span class="st">'thread_iB6WpSbp6r6j9ayrdHIyyafC'</span>)], <span class="bu">object</span><span class="op">=</span><span class="st">'list'</span>, first_id<span class="op">=</span><span class="st">'msg_mMdjZ6raDxzbYr065ojq9jav'</span>, last_id<span class="op">=</span><span class="st">'msg_0WMtoLxPzCXB14wNTIicUkqO'</span>, has_more<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="obtain-text-response" class="level1">
<h1>Obtain text response</h1>
<section id="display-response-of-assistant" class="level2">
<h2 class="anchored" data-anchor-id="display-response-of-assistant">Display response of assistant</h2>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the cursor to get all messages</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [message <span class="cf">for</span> message <span class="kw">in</span> messages_cursor]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The assistant's response should be the first message in the thread</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>assistant_response <span class="op">=</span> messages[<span class="dv">0</span>].content <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">"No response yet."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="output" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="output">Output</h2>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(assistant_response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>[MessageContentImageFile(image_file<span class="op">=</span>ImageFile(file_id<span class="op">=</span><span class="st">'file-98KwkltWZr4n0kZxMUdqIzTM'</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'image_file'</span>), MessageContentText(text<span class="op">=</span>Text(annotations<span class="op">=</span>[], value<span class="op">=</span><span class="st">"The scatter plot above displays the relationship between 'Horsepower' and 'Miles per Gallon' (MPG). From the plot, we can observe the following:</span><span class="ch">\n\n</span><span class="st">- There is a general negative correlation between Horsepower and Miles per Gallon. This means that as Horsepower increases, MPG tends to decrease.</span><span class="ch">\n</span><span class="st">- This relationship can be attributed to the fact that cars with higher horsepower values are usually more powerful and may require more fuel to sustain that power, resulting in lower fuel efficiency.</span><span class="ch">\n\n</span><span class="st">However, it is important to note that other factors not depicted in this plot could also influence the MPG, such as the weight of the car, the type of engine, and aerodynamic design. For more comprehensive insights, it would be beneficial to consider these variables in future analyses.</span><span class="ch">\n\n</span><span class="st">Would you like to perform any further analysis on this dataset or have any other questions?"</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="extract-only-text-response" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="extract-only-text-response">Extract only text response</h2>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>assistant_response[<span class="dv">1</span>].text.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>“The scatter plot above displays the relationship between ‘Horsepower’ and ‘Miles per Gallon’ (MPG). From the plot, we can observe the following:- There is a general negative correlation between Horsepower and Miles per Gallon. This means that as Horsepower increases, MPG tends to decrease.- This relationship can be attributed to the fact that cars with higher horsepower values are usually more powerful and may require more fuel to sustain that power, resulting in lower fuel efficiency., it is important to note that other factors not depicted in this plot could also influence the MPG, such as the weight of the car, the type of engine, and aerodynamic design. For more comprehensive insights, it would be beneficial to consider these variables in future analyses.you like to perform any further analysis on this dataset or have any other questions?”</li>
</ul>
</section>
</section>
<section id="download-images-and-files" class="level1">
<h1>Download images and files</h1>
<ul>
<li><p>The API also outputs files, such as generating image diagrams, CSVs, and PDFs.</p></li>
<li><p>There are two types of files that are generated:</p>
<ul>
<li>Images</li>
<li>Data files (e.g.&nbsp;a csv file with data generated by the Assistant)</li>
</ul></li>
</ul>
<section id="get-file-content" class="level2">
<h2 class="anchored" data-anchor-id="get-file-content">Get file content</h2>
<ul>
<li>The file content can then be downloaded by passing the file ID to the Files API</li>
</ul>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>response_file_id <span class="op">=</span> assistant_response[<span class="dv">0</span>].image_file.file_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response_file_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>file-98KwkltWZr4n0kZxMUdqIzTM</li>
</ul>
<div id="cell-50" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>content <span class="op">=</span> client.files.retrieve_content(response_file_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="work-in-progress" class="level2">
<h2 class="anchored" data-anchor-id="work-in-progress">Work in progress 😊</h2>
<p>tbd</p>
<!--

::: {#cell-52 .cell}
``` {.python .cell-code}
filename = "output_image.png"  # Use the correct file extension

# Ensure that content is bytes
if isinstance(content, str):
    # If content is a string, encode it to bytes
    content_bytes = content.encode('utf-8')
else:
    # If content is already bytes, no need to encode
    content_bytes = content

# Write the content to a file
with open(filename, 'wb') as file:
    file.write(content_bytes)

print(f"Image saved as {filename}.")
```
:::


::: {#cell-53 .cell}
``` {.python .cell-code}
filename = "output_image.png"  # or .jpg, .jpeg, .bmp, etc. depending on the image format

# Write the binary content to a file
with open(filename, 'wb') as file:
    file.write(content)
print(f"Image saved as {filename}.")

```
:::


::: {#cell-54 .cell}
``` {.python .cell-code}
filename = "output_image.png"  # Adjust the filename and extension as necessary

# If 'content' is a string that represents the binary data, we need to convert it to bytes.
# We will attempt to do this using the 'latin1' codec which maps directly to the first 256 Unicode characters.
# This will effectively create a byte-for-byte identical mapping, which is what we want for binary data.
try:
    if isinstance(content, str):
        # Encode the string to bytes using 'latin1' which is a direct mapping
        content_bytes = content.encode('latin-1')
    else:
        # If 'content' is already in bytes, we don't need to encode it
        content_bytes = content

    # Write the content to the file
    with open(filename, 'wb') as file:
        file.write(content_bytes)

    print(f"File saved as {filename}.")
except UnicodeEncodeError as e:
    print(f"Encoding error: {e}")
except Exception as e:
    print(f"An error occurred: {e}")
```
:::


-->
</section>
</section>
<section id="input-and-output-logs-of-code-interpreter" class="level1">
<h1>Input and output logs of Code Interpreter</h1>
<section id="run-steps" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="run-steps">Run steps</h2>
<ul>
<li>By listing the steps of a Run that called Code Interpreter, you can inspect the code input and outputs logs of Code Interpreter:</li>
</ul>
<div id="cell-56" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>run_steps <span class="op">=</span> client.beta.threads.runs.steps.<span class="bu">list</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  thread_id<span class="op">=</span>thread.<span class="bu">id</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  run_id<span class="op">=</span>run.<span class="bu">id</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(run_steps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kirenz\.github\.io\/lab-assistants-api\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© <a href="https://www.kirenz.com/">Jan Kirenz</a>, 2023</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../slide.html">
<p>Slides</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../require.html">
<p>Requirements</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../assignments.html">
<p>Assignments</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://moodle.hdm-stuttgart.de/login/index.php">
      <i class="bi bi-person-circle" role="img" aria-label="Moodle">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>